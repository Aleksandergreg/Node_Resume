<main class="flex-1 max-w-5xl mx-auto py-12 px-4 md:px-8">
  <div class="bg-white shadow-custom rounded-lg p-6 md:p-12">

    <div class="border-b border-secondary-200 pb-6 mb-10">
      <h1 class="text-3xl font-bold mb-6 text-primary-700">Creating a server on express</h1>
    </div>

    <div class="prose lg:prose-lg max-w-none">
      <p class="mb-4 leading-relaxed">
        To create a server on Express, we need to import the Express module, which can be found under our
        <span class="font-mono text-sm bg-gray-100 px-1">node_modules</span> generated by our npm install when declared in our <span class="font-mono text-sm bg-gray-100 px-1">package.json</span>. There are <strong>two ways</strong> of solving
        this issue, either using the <span class="text-primary-600 font-medium">CommonJS module</span>, or by the <span class="text-primary-600 font-medium">ES modules</span>.
      </p>

      <h3 class="text-xl font-bold mt-6 mb-3 text-primary-600">Method 1: CommonJS Module</h3>

      <p class="mb-4 leading-relaxed font-semibold">The first way, using the CommonJS module, would be done like this:</p>

      <pre class="bg-secondary-900 text-white p-5 rounded-lg mb-6 border-l-4 border-primary-500 overflow-x-auto">
<code class="language-javascript">const express = require('express');
const app = express();</code>
      </pre>

      <h3 class="text-xl font-bold mt-6 mb-3 text-primary-600">Method 2: ES Modules</h3>

      <p class="mb-4 leading-relaxed">
        The other way of doing it is using the ES modules. Before we can use this solution, we need to add the
        <span class="bg-gray-100 px-1 py-0.5 rounded">type:module</span> inside our package.json. This should be done like this:
      </p>

      <pre class="bg-secondary-900 text-white p-5 rounded-lg mb-6 border-l-4 border-primary-500 overflow-x-auto">
<code class="language-json">{
 "type": "module",
 "dependencies": {
   "express": "^4.21.2"
 }
}</code>
      </pre>

      <p class="mb-4 leading-relaxed">
        Then in our file we need to import express as a module, and then initialize it like we did before:
      </p>

      <pre class="bg-secondary-900 text-white p-5 rounded-lg mb-6 border-l-4 border-primary-500 overflow-x-auto">
<code class="language-javascript">import express from 'express';
const app = express();</code>
      </pre>

      <div class="bg-blue-50 p-4 rounded-lg mb-6 border-l-4 border-blue-400">
        <p class="leading-relaxed">
          Since we are using modern JavaScript ES6 and forward, we will always use <span class="font-mono text-sm bg-gray-100 px-1">import</span>, but it is good knowledge to
          know about the CommonJS way, if you ever see yourself working on older Node.js projects.
        </p>
      </div>

      <h3 class="text-xl font-bold mt-6 mb-3 text-primary-600">Setting Up a Server Port</h3>

      <p class="mb-4 leading-relaxed">
        Now we need to make our server run on a port. This is done by adding a port by using the build in method for
        our app called <span class="font-mono text-sm bg-gray-100 px-1">app.listen</span>:
      </p>

      <pre class="bg-secondary-900 text-white p-5 rounded-lg mb-6 border-l-4 border-primary-500 overflow-x-auto">
<code class="language-javascript">PORT = 8080;
app.listen(PORT, ( ) => console.log("Server is running on port, PORT));</code>
      </pre>

      <h3 class="text-xl font-bold mt-6 mb-3 text-primary-600">Enabling JSON Parsing</h3>

      <p class="mb-4 leading-relaxed">
        Now we can run our server on port 8080, using express. There are some modifications to our server that we
        would like to implement in most cases though, for it to be able to handle various tasks. The first thing we
        would like to do, depending on the functionality of our application, is to enable <strong>Express middleware</strong> that
        makes it possible for us to parse JSON request bodies. So why is this needed and how is it done? The client
        wants to send JSON data in a request body to our server, Node.js will <span class="text-red-600 font-medium">not understand this</span>:
      </p>

      <pre class="bg-secondary-900 text-white p-5 rounded-lg mb-6 border-l-4 border-primary-500 overflow-x-auto">
<code class="language-json">{
  "name": "Alice",
  "age": 25
}</code>
      </pre>

      <p class="mb-4 leading-relaxed">
        So if we do:
      </p>

      <pre class="bg-secondary-900 text-white p-5 rounded-lg mb-6 border-l-4 border-primary-500 overflow-x-auto">
<code class="language-javascript">app.post('/data', (req, res) => {
console.log(req.body); //undefined 
res.send("Recieved);
});</code>
      </pre>

      <p class="mb-4 leading-relaxed">
        This is as said not possible as the <span class="font-mono text-sm bg-gray-100 px-1">req.body</span> with the raw JSON body is not parsed.
      </p>

      <h3 class="text-xl font-bold mt-6 mb-3 text-green-600">Solution</h3>

      <p class="mb-4 leading-relaxed">
        If we instead add the middleware to our program like this, now the server can parse the JSON body:
      </p>

      <pre class="bg-secondary-900 text-white p-5 rounded-lg mb-6 border-l-4 border-primary-500 overflow-x-auto">
<code class="language-javascript">app.use(express.json()); // enables JSON parsing

app.post('/data', (req, res) => {
console.log(req.body); // { name: 'Alice', age: 25 }
res.send("Recieved);
});</code>
      </pre>

      <div class="bg-yellow-50 p-4 rounded-lg mb-6 border-l-4 border-yellow-400">
        <p class="leading-relaxed">
          So whenever we have a <span class="font-bold">POST</span>, <span class="font-bold">PUT</span> or <span class="font-bold">PATCH</span> request that sends JSON inside of the request body, we need to
          implement this middleware. If we just have an application with simple GET requests, this is not needed.
        </p>
      </div>

      <h2 class="text-3xl font-bold mb-6 text-primary-700">Serving static files in Express</h2>

      <p class="mb-4 leading-relaxed">
        Now that we have created our server, we need to think about our <strong>project structure</strong> before starting to build
        our full stack application. A good way to start is to think about which files are <span class="text-primary-600 font-medium">client files</span> and which are
        <span class="text-primary-600 font-medium">server files</span>. All the files that you define as client side, should be placed inside a <span class="bg-gray-100 px-1 py-0.5 rounded">public</span> folder. A good
        way of organizing this is to make a subfolder inside of the public folder, for e.g <em>frontpage</em>, <em>movies</em>,
        <em>bookings</em> etc. if we take a basis in a cinema booking application.
      </p>
      
      <p class="mb-4 leading-relaxed">
        Inside the public folder we will also create a subfolder called <span class="bg-gray-100 px-1 py-0.5 rounded">assets</span>, in this folder we can then have another set of subfolders for everything
        that are shared across multiple pages e.g <span class="text-blue-600">css</span>, <span class="text-green-600">images</span> and <span class="text-amber-600">js</span>. This gives a good logical structure, and is
        also very scalable, while keeping a clean project structure.
      </p>
      
      <h3 class="text-xl font-bold mt-6 mb-3 text-primary-600">Implementation</h3>
      
      <p class="mb-4 leading-relaxed">
        The way we can do this is to put the following code in our main app.js file:
      </p>
      
      <pre class="bg-secondary-900 text-white p-5 rounded-lg mb-6 border-l-4 border-primary-500 overflow-x-auto">
        <code class="language-javascript">app.use(express.static('public'));</code>
      </pre>
      
      <div class="bg-blue-50 p-4 rounded-lg mb-6 border-l-4 border-blue-400">
        <p class="leading-relaxed">
          This makes the file inside <span class="bg-gray-100 px-1 py-0.5 rounded">"public"</span> accessible to the client. Without this, Express does not serve static
          files, and only API routes are available.
        </p>
      </div>
      
      <h3 class="text-xl font-bold mt-6 mb-3 text-red-600">Security Warning</h3>
      
      <p class="mb-4 leading-relaxed">
        If we accidentally put server files inside public, they could be
        accessed by anyone. This would create a <strong>big security risk</strong>. Let's say we put our public/database-config.js,
        they could be accessed by anyone. Everything that's not inside of the public folder should be serverfiles,
        like <span class="font-mono text-sm bg-gray-100 px-1">util</span>, <span class="font-mono text-sm bg-gray-100 px-1">app.js</span>, <span class="font-mono text-sm bg-gray-100 px-1">packagelock-json</span>, <span class="font-mono text-sm bg-gray-100 px-1">package.json</span> and <span class="font-mono text-sm bg-gray-100 px-1">.gitignore</span>.
      </p>
    </div> 
  </div>
</main>